<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle ‚Äì Classic</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg1:#0a1930;--bg2:#00010f;--c1:#eaf2ff;--c3:#a8cfff}
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:'Outfit',sans-serif;color:var(--c1);background:radial-gradient(circle at 25% 25%,var(--bg1),var(--bg2) 80%)}

  /* ===== NAVBAR ===== */
  nav{
    position:fixed; top:0; left:0; width:100%;
    display:flex; justify-content:center; gap:40px; padding:18px 0;
    background:rgba(10,15,40,.35); backdrop-filter:blur(12px);
    border-bottom:1px solid rgba(255,255,255,.05); z-index:1000;
    box-shadow:0 0 20px rgba(102,170,255,.15);
  }
  nav a{
    color:#b8d0ff; text-decoration:none; font-weight:400; transition:.3s;
    letter-spacing:1px; font-size:.95em; position:relative;
  }
  nav a::after{
    content:""; position:absolute; bottom:-5px; left:0; width:0; height:2px;
    background:#66aaff; transition:width .3s;
  }
  nav a:hover::after{ width:100%; }
  nav a:hover{ color:#66aaff; text-shadow:0 0 8px #66aaff; }

  .wrap{max-width:1200px;margin:0 auto;padding:130px 6% 40px}
  .hd{text-align:center;margin-bottom:18px}
  .hd h1{color:#89c4ff;text-shadow:0 0 10px rgba(102,170,255,.25)}
  .top{display:flex;gap:12px;justify-content:space-between;align-items:center;margin-bottom:12px}
  .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06)}
  .btn{padding:10px 18px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--c1);cursor:pointer;box-shadow:0 0 10px rgba(102,170,255,.25)}
  .btn:hover{transform:translateY(-2px);box-shadow:0 0 18px rgba(102,170,255,.35)}
  .btn.main{background:linear-gradient(90deg,#003366,#0055aa);border:none}
  .board-wrap{display:grid;grid-template-columns:1fr 320px;gap:18px}
  @media (max-width:980px){.board-wrap{grid-template-columns:1fr}}
  .board{aspect-ratio:1/1;width:100%;background:#02040c;border-radius:20px;border:1px solid rgba(255,255,255,.1);box-shadow:0 0 22px rgba(102,170,255,.15);display:grid;overflow:hidden;position:relative}
  .tile{background-repeat:no-repeat;background-size:var(--bgW) var(--bgH);border:1px solid rgba(255,255,255,.06)}
  .side{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:16px;box-shadow:0 0 22px rgba(102,170,255,.15);height:fit-content}
  .side h3{color:var(--c3);margin-bottom:10px}
  .thumb img{width:100%;display:block;border-radius:12px;border:1px solid rgba(255,255,255,.1)}
  .win{position:absolute;inset:0;display:none;place-items:center;background:rgba(2,4,12,.55);backdrop-filter:blur(4px)}
  .win .box{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);border-radius:20px;padding:20px;text-align:center;box-shadow:0 0 24px rgba(102,170,255,.35)}
  footer{text-align:center;padding:45px 0;color:#7a8cb3;font-size:.9em;border-top:1px solid rgba(255,255,255,.05);background:#02040c}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav>
  <a href="/inicio">Home</a>
  <a href="/pronostico">Forecast</a>
      <a href="/agenda">Agenda</a>
  <a href="/comparar">Compare Locations</a>
  <a href="/educacion">Education</a>
  <a href="/juego">Mini Games</a>
  <a href="/login">Login</a>
  <a href="/perfil">My Profile</a>
  <a href="/logout" style="color:#ff6b6b;">Log Out</a>
</nav>

<div class="wrap">
  <header class="hd">
    <h1>Puzzle ‚Äì Classic</h1>
    <p>Drag the pieces to form the image.</p>
  </header>

  <div class="top">
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <span class="badge" id="dimBadge">0√ó0</span>
      <span class="badge">Moves: <b id="moves">0</b></span>
      <span class="badge">Time: <b id="time">00:00</b></span>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn" id="btnReiniciar">Restart</button>
      <a class="btn main" href="/juego/clasico">‚Üê Back</a>
    </div>
  </div>

  <div class="board-wrap">
    <div class="board" id="board"></div>
    <aside class="side">
      <h3>Preview</h3>
      <div class="thumb"><img id="thumb" alt="Preview"></div>
      <p style="color:#7a8cb3;margin-top:8px">Tip: make the window larger if you want bigger pieces.</p>
    </aside>
  </div>
</div>

<div class="win" id="win">
  <div class="box">
    <h2 style="color:#89c4ff">Completed! üéâ</h2>
    <p>Time: <b id="wTime">00:00</b> ¬∑ Moves: <b id="wMoves">0</b></p>
    <div style="margin-top:12px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button class="btn" id="btnAgain">Play Again</button>
      <a class="btn main" href="/juego/clasico">Back to Gallery</a>
    </div>
  </div>
</div>

<script>
/* ===== util ===== */
const $ = s => document.querySelector(s);
function getHashParam(name){ const m=(location.hash||'').match(new RegExp(name+'=([^&]+)')); return m? decodeURIComponent(m[1]) : null; }
const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
function bestFactorPair(n){
  n = Math.max(3, Math.min(60, n|0));
  let bestR=1,bestC=n,d=n-1;
  for(let r=1;r<=Math.sqrt(n);r++) if(n%r===0){const c=n/r; if(Math.abs(c-r)<d){d=Math.abs(c-r);bestR=r;bestC=c;}}
  if(bestR*bestC!==n){bestR=Math.floor(Math.sqrt(n));bestC=Math.ceil(n/bestR);}
  return {rows:bestR, cols:bestC};
}

/* ===== inputs (hash or session) ===== */
const imgSrc = getHashParam('img') || sessionStorage.getItem('rompecabezas_imagen');
const nPieces = Number(getHashParam('n') || sessionStorage.getItem('rompecabezas_piezas') || 16);
if(!imgSrc){ alert('No image selected.'); location.href='./clasico.html'; }

$('#thumb').src = imgSrc;

/* ===== board ===== */
const board = $('#board'), movesEl = $('#moves'), timeEl = $('#time'), dimBadge = $('#dimBadge');
let rows, cols, tiles, order=[], solved=[], moves=0, seconds=0, timer=null;

function startTimer(){ clearInterval(timer); seconds=0; timeEl.textContent='00:00'; timer=setInterval(()=>{seconds++; const m=String(Math.floor(seconds/60)).padStart(2,'0'); const s=String(seconds%60).padStart(2,'0'); timeEl.textContent=`${m}:${s}`;},1000); }
function stopTimer(){ clearInterval(timer); timer=null; }

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } if(a.every((v,i)=>v===i)) return shuffle(a); return a; }

function createBoard(){
  const f = bestFactorPair(nPieces); rows=f.rows; cols=f.cols; tiles=rows*cols;
  board.style.gridTemplateColumns = `repeat(${cols},1fr)`;
  board.style.gridTemplateRows = `repeat(${rows},1fr)`;
  dimBadge.textContent = `${rows}√ó${cols}`;
  solved = Array.from({length:tiles}, (_,i)=>i);
  order = shuffle([...solved]);
  render();
  startTimer();
}

function render(){
  board.innerHTML='';
  board.style.setProperty('--bgW', `${cols*100}%`);
  board.style.setProperty('--bgH', `${rows*100}%`);
  order.forEach((pieceIdx, pos)=>{
    const r = Math.floor(pieceIdx/cols), c = pieceIdx%cols;
    const el = document.createElement('div');
    el.className='tile'; el.draggable=true;
    el.style.backgroundImage = `url(${imgSrc})`;
    el.style.backgroundPosition = `${(c/(cols-1))*100}% ${(r/(rows-1))*100}%`;
    el.addEventListener('dragstart', ev=>{ ev.dataTransfer.setData('text/plain', pos); });
    el.addEventListener('dragover', ev=>ev.preventDefault());
    el.addEventListener('drop', ev=>{
      ev.preventDefault();
      const from = Number(ev.dataTransfer.getData('text/plain'));
      const to = pos; if(from===to) return;
      [order[from], order[to]] = [order[to], order[from]];
      moves++; movesEl.textContent = moves;
      render();
      checkWin();
    });
    board.appendChild(el);
  });
}

function checkWin(){
  if(order.every((v,i)=>v===i)){
    stopTimer();
    $('#wTime').textContent = timeEl.textContent;
    $('#wMoves').textContent = String(moves);
    $('#win').style.display='grid';
  }
}

/* ===== controls ===== */

$('#btnReiniciar').addEventListener('click', ()=>{ moves=0; movesEl.textContent='0'; startTimer(); order = shuffle([...solved]); render(); });
$('#btnAgain').addEventListener('click', ()=>{ $('#win').style.display='none'; $('#btnReiniciar').click(); });

/* ===== init ===== */
createBoard();
</script>
  <footer>
    ¬© 2025 EcoWheater | Designed with üíô for the planet
  </footer>

</body>
</html>
